# Há»‡ thá»‘ng Pháº¡t (Penalties) - Cáº­p nháº­t KPI Central

## Tá»•ng quan

ÄÃ£ triá»ƒn khai Ä‘áº§y Ä‘á»§ **há»‡ thá»‘ng pháº¡t (penalties)** vÃ  **2 vá»‹ trÃ­ má»›i** dá»±a trÃªn chÆ°Æ¡ng trÃ¬nh KPI chi tiáº¿t cá»§a cÃ´ng ty. Há»‡ thá»‘ng hiá»‡n táº¡i Ä‘Ã£ hoÃ n thiá»‡n vá»›i cáº£ rewards vÃ  penalties cho táº¥t cáº£ cÃ¡c vá»‹ trÃ­.

## TÃ­nh nÄƒng má»›i Ä‘Æ°á»£c thÃªm

### 1. Há»‡ thá»‘ng Pháº¡t (Penalties)

#### Cáº¥u trÃºc dá»¯ liá»‡u má»›i:
- **`PenaltyCriteria`** - TiÃªu chÃ­ pháº¡t vá»›i cÃ¡c loáº¡i:
  - `fixed` - Pháº¡t cá»‘ Ä‘á»‹nh
  - `variable` - Pháº¡t biáº¿n Ä‘á»™ng
  - `percentage` - Pháº¡t theo pháº§n trÄƒm
  - `warning` - Cáº£nh cÃ¡o (khÃ´ng pháº¡t tiá»n)

- **`PenaltyCondition`** - Äiá»u kiá»‡n Ä‘á»ƒ bá»‹ pháº¡t
- **`PenaltyBreakdown`** - Chi tiáº¿t tÃ­nh toÃ¡n pháº¡t
- **`severity`** - Má»©c Ä‘á»™ nghiÃªm trá»ng: `low`, `medium`, `high`

#### Logic tÃ­nh toÃ¡n má»›i:
- **Tá»•ng thÆ°á»Ÿng (totalReward)**
- **Tá»•ng pháº¡t (totalPenalty)** 
- **Thá»±c nháº­n (netAmount)** = totalReward - totalPenalty (â‰¥ 0)

### 2. Penalties cho tá»«ng vá»‹ trÃ­

#### **IT Staff**
- ğŸš¨ **300.000 VND** cho thá»i gian cháº¿t há»‡ thá»‘ng
- ğŸš¨ **500.000 VND** cho nháº­t kÃ½ khÃ´ng Ä‘áº§y Ä‘á»§

#### **Head of Marketing** 
- âš ï¸ **KhÃ´ng thÆ°á»Ÿng** náº¿u < 20 leads
- ğŸš¨ **500.000 VND** cho leads giáº£ máº¡o

#### **Marketing Assistant**
- âš ï¸ **KhÃ´ng thÆ°á»Ÿng** náº¿u < 20 leads  
- âš ï¸ **Cáº£nh cÃ¡o** cho leads giáº£ máº¡o

#### **Customer Service Officer (CSO)**
- ğŸš¨ **500.000 VND/lá»—i** chá»©ng tá»«
- âš ï¸ **Cáº£nh cÃ¡o** bá» lá»¡ follow-up khÃ¡ch hÃ ng

#### **Credit Appraiser (CA)**
- ğŸš¨ **500.000 VND** náº¿u tá»· lá»‡ ná»£ xáº¥u > 10%
- ğŸ”¶ **200.000 VND** cho nháº­t kÃ½ thu há»“i ná»£ khÃ´ng Ä‘áº§y Ä‘á»§

#### **HR/Admin Staff** (Má»šI)
- ğŸš¨ **300.000 VND** cháº­m tráº£ lÆ°Æ¡ng
- ğŸ”¶ **200.000 VND** ná»™p há»“ sÆ¡ muá»™n

#### **Accountant** (Má»šI)  
- ğŸš¨ **300.000 VND** ná»™p thuáº¿ muá»™n
- ğŸ”¶ **200.000 VND** chÃªnh lá»‡ch tiá»n máº·t/ngÃ¢n hÃ ng

### 3. Hai vá»‹ trÃ­ má»›i

#### **HR/Admin Staff - NhÃ¢n ViÃªn HÃ nh ChÃ­nh**
**ThÆ°á»Ÿng hÃ ng quÃ½:**
- 300.000 VND - Há»“ sÆ¡ nhÃ¢n sá»± hoÃ n thiá»‡n
- 300.000 VND - Báº£ng lÆ°Æ¡ng chÃ­nh xÃ¡c 
- 200.000 VND - TuÃ¢n thá»§ Ä‘áº§y Ä‘á»§
- 200.000 VND - SÃ¡ng kiáº¿n HR

**ThÆ°á»Ÿng hÃ ng nÄƒm:**
- 1-2 triá»‡u VND - KhÃ´ng vi pháº¡m tuÃ¢n thá»§
- 2-5 triá»‡u VND - Cáº£i tiáº¿n há»‡ thá»‘ng HR  
- LÆ°Æ¡ng thÃ¡ng 13

#### **Accountant - Káº¿ ToÃ¡n**
**ThÆ°á»Ÿng hÃ ng quÃ½:**
- 300.000 VND - BÃ¡o cÃ¡o tÃ i chÃ­nh Ä‘áº§y Ä‘á»§
- 300.000 VND - Äá»‘i chiáº¿u chÃ­nh xÃ¡c
- 200.000 VND - Tiáº¿t kiá»‡m chi phÃ­
- 300.000 VND - Khai thuáº¿ Ä‘Ãºng háº¡n

**ThÆ°á»Ÿng hÃ ng nÄƒm:**
- 2-5 triá»‡u VND - Káº¿t quáº£ kiá»ƒm toÃ¡n tá»‘t
- 1-2 triá»‡u VND - Tiáº¿t kiá»‡m dá»± bÃ¡o
- LÆ°Æ¡ng thÃ¡ng 13

## Cáº­p nháº­t UI/UX

### 1. Reward Calculation Display
- **5 cards thá»‘ng kÃª**: Tá»•ng thÆ°á»Ÿng, Tá»•ng pháº¡t, Thá»±c nháº­n, TiÃªu chÃ­ Ä‘áº¡t, Vi pháº¡m
- **Penalty section**: Hiá»ƒn thá»‹ chi tiáº¿t vi pháº¡m vá»›i severity badges
- **Detail dialog**: Breakdown Ä‘áº§y Ä‘á»§ cáº£ rewards vÃ  penalties

### 2. Reward Calculations Table  
- **ThÃªm cá»™t**: Pháº¡t, Thá»±c nháº­n
- **Color coding**: 
  - ğŸŸ¢ Tá»•ng thÆ°á»Ÿng (xanh lÃ¡)
  - ğŸ”´ Pháº¡t (Ä‘á») 
  - ğŸ”µ Thá»±c nháº­n (xanh dÆ°Æ¡ng)

### 3. Severity Indicators
- ğŸš¨ **High** (NghiÃªm trá»ng) - Äá»
- ğŸ”¶ **Medium** (Trung bÃ¬nh) - VÃ ng  
- âš ï¸ **Low/Warning** (Nháº¹/Cáº£nh cÃ¡o) - XÃ¡m

## Technical Implementation

### Database Schema Updates
```
/rewardPrograms
  + penalties: PenaltyCriteria[]

/rewardCalculations  
  + totalPenalty: number
  + netAmount: number
  + penalties: PenaltyBreakdown[]
```

### New Position Configs
```
- HR/Admin Staff (hr-admin-config)
- Accountant (accountant-config)
```

### Enhanced Calculation Engine
- Kiá»ƒm tra Ä‘iá»u kiá»‡n penalty song song vá»›i rewards
- TÃ­nh toÃ¡n net amount = rewards - penalties
- Äáº£m báº£o net amount â‰¥ 0 
- Há»— trá»£ warning penalties (khÃ´ng trá»« tiá»n)

## Metrics cáº§n nháº­p cho vá»‹ trÃ­ má»›i

### HR/Admin Staff
- `personnel_records_completeness` - Há»“ sÆ¡ nhÃ¢n sá»± hoÃ n thiá»‡n
- `payroll_accuracy_percentage` - Äá»™ chÃ­nh xÃ¡c báº£ng lÆ°Æ¡ng
- `compliance_requirements_met` - TuÃ¢n thá»§ quy Ä‘á»‹nh
- `late_salary_payments_count` - Sá»‘ láº§n tráº£ lÆ°Æ¡ng muá»™n
- `late_document_submissions_count` - Sá»‘ láº§n ná»™p há»“ sÆ¡ muá»™n

### Accountant  
- `financial_reports_completeness` - BÃ¡o cÃ¡o tÃ i chÃ­nh hoÃ n thiá»‡n
- `account_reconciliation_accuracy` - Äá»™ chÃ­nh xÃ¡c Ä‘á»‘i chiáº¿u
- `cost_savings_amount` - Sá»‘ tiá»n tiáº¿t kiá»‡m Ä‘Æ°á»£c
- `late_tax_submissions_count` - Sá»‘ láº§n ná»™p thuáº¿ muá»™n
- `cash_bank_discrepancies_count` - Sá»‘ láº§n chÃªnh lá»‡ch tiá»n máº·t/ngÃ¢n hÃ ng

## Workflow má»›i

1. **Nháº­p metrics** â†’ Include penalty-related metrics
2. **TÃ­nh toÃ¡n** â†’ Engine xá»­ lÃ½ cáº£ rewards vÃ  penalties
3. **Review** â†’ Xem chi tiáº¿t breakdown vá»›i severity levels
4. **Approve** â†’ PhÃª duyá»‡t dá»±a trÃªn net amount
5. **Track** â†’ Theo dÃµi penalties Ä‘á»ƒ cáº£i thiá»‡n performance

## Testing Scenarios

### Test Cases cho Penalties:
âœ… IT Staff vá»›i system downtime â†’ Penalty applied  
âœ… Marketing vá»›i fake leads â†’ Penalty applied
âœ… HR vá»›i late salary â†’ Penalty applied  
âœ… Accountant vá»›i late tax â†’ Penalty applied
âœ… Warning penalties â†’ No money deduction
âœ… Net amount calculation â†’ Always â‰¥ 0

### Test Cases cho New Positions:
âœ… HR/Admin quarterly rewards calculation
âœ… Accountant annual performance bonus
âœ… Position config metrics validation
âœ… UI display for new positions

## Performance Impact

- âœ… **No breaking changes** - Existing data remains compatible
- âœ… **Backward compatibility** - Old calculations still work  
- âœ… **Graceful degradation** - Handles missing penalty data
- âœ… **Optimized queries** - Efficient penalty calculation

## Migration Guide

### For Existing Data:
```typescript
// Old calculations will show:
totalPenalty: 0
netAmount: totalReward
penalties: []
```

### For New Setup:
1. Initialize reward programs vá»›i penalties
2. Setup position configs cho HR/Admin & Accountant
3. Train users vá» penalty metrics input
4. Monitor penalty trends vÃ  adjust thresholds

## Summary

ğŸ‰ **Há»‡ thá»‘ng KPI Central hiá»‡n Ä‘Ã£ hoÃ n thiá»‡n** vá»›i:

- âœ… **7 vá»‹ trÃ­** vá»›i reward programs Ä‘áº§y Ä‘á»§
- âœ… **Penalty system** vá»›i 4 loáº¡i pháº¡t 
- âœ… **Smart calculation** engine vá»›i net amount
- âœ… **Rich UI** Ä‘á»ƒ manage vÃ  track penalties
- âœ… **Scalable architecture** cho future positions
- âœ… **Complete workflow** tá»« input â†’ calculation â†’ approval

Há»‡ thá»‘ng giá» Ä‘Ã¢y pháº£n Ã¡nh chÃ­nh xÃ¡c chÆ°Æ¡ng trÃ¬nh KPI thá»±c táº¿ cá»§a cÃ´ng ty vÃ  sáºµn sÃ ng cho production deployment!
